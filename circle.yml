general:
    branches:
        ignore:
            - /^ultron\/.*/ # Ignore ultron/* branches

machine:
    node:
        version: 6.13.1
    services:
        - docker
        - redis
    environment:
        CXX: g++-4.9

dependencies:
    override:
        - rm -rf node_modules
        - npm install
test:
    override:
        - docker run -e AUTO_CREATE_TOPICS=true -d --net=host --name kafka spotify/kafka
        - npm run --silent lint_md
        - npm run --silent lint
        - npm test
        - CI=true npm start & bash tests/utils/wait_for_local_port.bash 8900 40 && npm run ft_test:api:routes
        - CI=true BACKBEAT_CONFIG_FILE=tests/config.json npm start & bash tests/utils/wait_for_local_port.bash 8900 40 && CI_AUTH_TYPE=account npm run ft_test:api:retry
        - CI=true BACKBEAT_CONFIG_FILE=tests/config.roleAuth.json npm start & bash tests/utils/wait_for_local_port.bash 8900 40 && CI_AUTH_TYPE=role npm run ft_test:api:retry
        - npm run ft_test:replication
